<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Daily Jam — Catalog</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,700;0,900;1,700&family=Space+Mono:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0e0c0f; --surface: #161418; --surface2: #1e1b21; --border: #272330;
    --amber: #9b6dff; --amber-glow: rgba(155,109,255,0.12);
    --text: #e8e0d0; --text-dim: #7a7060; --text-muted: #3a3530;
    --red: #e85d4a; --green: #5dba7f; --blue: #5d8fe8;
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body { background: #0a0810; color: var(--text); font-family: 'Space Mono', monospace; min-height: 100vh; overflow-x: hidden; }
  body::before { content: ''; position: fixed; inset: 0; pointer-events: none; z-index: 0;
    background:
      radial-gradient(ellipse 90% 70% at 5%  0%,   rgba(155,109,255,0.38) 0%, transparent 65%),
      radial-gradient(ellipse 70% 60% at 95% 100%,  rgba(93,143,232,0.28)  0%, transparent 60%),
      radial-gradient(ellipse 55% 45% at 88% 5%,    rgba(232,93,143,0.18)  0%, transparent 55%),
      radial-gradient(ellipse 50% 40% at 3%  95%,   rgba(93,186,127,0.18)  0%, transparent 55%); }
  body::after  { content: ''; position: fixed; inset: 0; background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.04'/%3E%3C/svg%3E"); pointer-events: none; z-index: 9999; opacity: 0.4; }

  /* NAV */
  .site-nav { position: sticky; top: 0; z-index: 100; display: flex; align-items: center; justify-content: space-between; padding: 0 40px; height: 56px; background: rgba(14,12,15,0.95); border-bottom: 1px solid var(--border); backdrop-filter: blur(8px); }
  .site-logo { font-family: 'Space Mono', monospace; font-size: 16px; font-weight: 700; color: var(--text); text-decoration: none; letter-spacing: 1px; }
  .site-logo span { color: var(--amber); font-style: italic; }
  .nav-links { display: flex; gap: 4px; }
  .nav-link { font-size: 11px; letter-spacing: 2px; text-transform: uppercase; color: var(--text-dim); text-decoration: none; padding: 8px 14px; transition: color 0.15s; }
  .nav-link:hover { color: var(--text); }
  .nav-link.active { color: var(--amber); }

  .header { padding: 32px 40px 0; border-bottom: 1px solid var(--border); }
  .header-top { display: flex; align-items: flex-end; justify-content: space-between; margin-bottom: 28px; gap: 20px; flex-wrap: wrap; }
  .title-block h1 { font-family: 'Playfair Display', serif; font-size: clamp(36px, 5vw, 64px); font-weight: 900; line-height: 0.9; letter-spacing: -2px; }
  .title-block h1 span { color: var(--amber); }
  .title-block p { margin-top: 12px; font-size: 11px; color: var(--text-dim); letter-spacing: 3px; text-transform: uppercase; }
  .stats-strip { display: flex; gap: 32px; flex-wrap: wrap; }
  .stat { text-align: right; }
  .stat-num { font-family: 'Playfair Display', serif; font-size: 32px; font-weight: 700; color: var(--amber); line-height: 1; }
  .stat-label { font-size: 10px; color: var(--text-dim); letter-spacing: 2px; text-transform: uppercase; margin-top: 4px; }

  .year-tabs { display: flex; gap: 0; margin-top: 0; flex-wrap: wrap; }
  .year-tab { padding: 12px 18px; font-family: 'Space Mono', monospace; font-size: 11px; font-weight: 700; letter-spacing: 1px; color: var(--text-dim); background: transparent; border: none; border-bottom: 3px solid transparent; cursor: pointer; transition: all 0.15s; position: relative; top: 1px; white-space: nowrap; }
  .year-tab:hover { color: var(--text); }
  .year-tab.active { color: var(--amber); border-bottom-color: var(--amber); }

  .controls { padding: 16px 40px; display: flex; gap: 10px; align-items: center; flex-wrap: wrap; border-bottom: 1px solid var(--border); background: var(--surface); }
  .search-wrap { position: relative; flex: 1; min-width: 200px; max-width: 380px; }
  .search-wrap svg { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: var(--text-dim); pointer-events: none; }
  input[type="text"] { width: 100%; background: var(--surface2); border: 1px solid var(--border); color: var(--text); font-family: 'Space Mono', monospace; font-size: 13px; padding: 9px 12px 9px 38px; outline: none; transition: border-color 0.15s; }
  input[type="text"]:focus { border-color: var(--amber); }
  input[type="text"]::placeholder { color: var(--text-muted); }
  select { background: var(--surface2); border: 1px solid var(--border); color: var(--text); font-family: 'Space Mono', monospace; font-size: 12px; padding: 9px 12px; outline: none; cursor: pointer; transition: border-color 0.15s; }
  select:focus { border-color: var(--amber); }
  .result-count { font-size: 11px; color: var(--text-dim); letter-spacing: 1px; margin-left: auto; white-space: nowrap; }
  .result-count span { color: var(--amber); }

  .table-header { padding: 0 40px; background: var(--surface); border-bottom: 2px solid var(--border); }
  .table-header table { width: 100%; border-collapse: collapse; table-layout: fixed; }
  .table-header th { font-size: 10px; font-weight: 700; letter-spacing: 2px; text-transform: uppercase; color: var(--text-dim); padding: 13px 10px; text-align: left; white-space: nowrap; cursor: pointer; user-select: none; transition: color 0.15s; }
  .table-header th:hover { color: var(--amber); }
  .table-header th.sorted { color: var(--amber); }
  .table-header th.sorted::after { content: ' ↓'; }
  .table-header th.sorted.asc::after { content: ' ↑'; }

  .table-wrap { overflow-x: auto; padding: 0 40px 40px; }
  .table-wrap table { width: 100%; border-collapse: collapse; table-layout: fixed; }
  .table-wrap thead { display: none; }
  td { padding: 11px 10px; border-bottom: 1px solid var(--border); font-size: 13px; vertical-align: middle; }
  tr { transition: background 0.1s; cursor: pointer; }
  tr:hover td { background: var(--amber-glow); }

  .col-day  { width: 60px; }
  .col-song { width: 28%; }
  .col-artist { width: 20%; }
  .col-album { width: 20%; }
  .col-date { width: 110px; }
  .col-year { width: 80px; }
  .td-num { color: var(--text-muted); font-size: 11px; text-align: right; overflow: hidden; }
  .td-name { font-weight: 700; color: var(--text); overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
  .td-artist { color: var(--text-dim); overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
  .td-album { color: var(--text-muted); font-size: 12px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
  .td-date { color: var(--text-muted); font-size: 11px; white-space: nowrap; overflow: hidden; }

  .year-pill { display: inline-block; padding: 3px 7px; font-size: 10px; font-weight: 700; letter-spacing: 1px; border: 1px solid; }
  .year-pill.y1 { border-color: #5d8fe8; color: #5d8fe8; }
  .year-pill.y2 { border-color: #5dba7f; color: #5dba7f; }
  .year-pill.y3 { border-color: #e85d8f; color: #e85d8f; }
  .year-pill.y4 { border-color: #e8a45d; color: #e8a45d; }
  .year-pill.y5 { border-color: #a45de8; color: #a45de8; }
  .year-pill.y6 { border-color: #5de8e8; color: #5de8e8; }
  .year-pill.y7 { border-color: #e8e85d; color: #e8e85d; }
  .year-pill.y8 { border-color: #FF6B6B; color: #FF6B6B; }
  .y1-text { color: #5d8fe8 !important; } .y2-text { color: #5dba7f !important; } .y3-text { color: #e85d8f !important; }
  .y4-text { color: #e8a45d !important; } .y5-text { color: #a45de8 !important; } .y6-text { color: #5de8e8 !important; }
  .y7-text { color: #e8e85d !important; } .y8-text { color: #FF6B6B !important; }

  .explicit-tag { display: inline-block; background: var(--text-muted); color: var(--bg); font-size: 9px; font-weight: 700; padding: 1px 4px; margin-left: 5px; vertical-align: middle; }

  .pagination { display: flex; align-items: center; justify-content: center; gap: 6px; padding: 24px 40px; border-top: 1px solid var(--border); flex-wrap: wrap; }
  .page-btn { background: var(--surface2); border: 1px solid var(--border); color: var(--text-dim); font-family: 'Space Mono', monospace; font-size: 12px; padding: 7px 13px; cursor: pointer; transition: all 0.15s; }
  .page-btn:hover { border-color: var(--amber); color: var(--amber); }
  .page-btn.active { background: var(--amber); color: var(--bg); border-color: var(--amber); font-weight: 700; }
  .page-btn:disabled { opacity: 0.3; cursor: default; }
  .page-btn:disabled:hover { border-color: var(--border); color: var(--text-dim); }

  .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.87); z-index: 1000; display: none; align-items: center; justify-content: center; padding: 20px; }
  .modal-overlay.open { display: flex; }
  .modal { background: var(--surface); border: 1px solid var(--border); max-width: 540px; width: 100%; position: relative; animation: modalIn 0.18s ease-out; }
  @keyframes modalIn { from { opacity: 0; transform: translateY(16px); } to { opacity: 1; transform: translateY(0); } }
  .modal-header { padding: 28px 28px 18px; border-bottom: 1px solid var(--border); }
  .modal-header h2 { font-family: 'Playfair Display', serif; font-size: 24px; font-weight: 700; line-height: 1.2; margin-bottom: 5px; color: #f0e8d8; }
  .modal-artist { font-size: 13px; color: var(--amber); margin-bottom: 3px; }
  .modal-album { font-size: 12px; color: #7a7060; }
  .modal-body { padding: 20px 28px 26px; }
  .modal-meta { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; margin-bottom: 18px; }
  .modal-meta-item label { display: block; font-size: 9px; letter-spacing: 2px; text-transform: uppercase; color: var(--text-muted); margin-bottom: 3px; }
  .modal-meta-item span { font-size: 14px; color: #e8e0d0; font-weight: 700; }
  .modal-actions { margin-top: 18px; }
  .btn-spotify { display: inline-flex; align-items: center; gap: 8px; background: #1DB954; color: #000; font-family: 'Space Mono', monospace; font-size: 12px; font-weight: 700; padding: 10px 18px; text-decoration: none; letter-spacing: 1px; transition: opacity 0.15s; }
  .btn-spotify:hover { opacity: 0.85; }
  .modal-close { position: absolute; top: 12px; right: 14px; background: none; border: none; color: var(--text-muted); font-size: 22px; cursor: pointer; padding: 4px 8px; transition: color 0.15s; line-height: 1; }
  .modal-close:hover { color: var(--text); }

  .filter-banner { display: none; align-items: center; gap: 12px; padding: 10px 40px; background: var(--amber-glow); border-bottom: 1px solid var(--border); font-size: 12px; color: var(--text-dim); letter-spacing: 1px; }
  .filter-banner.visible { display: flex; }
  .filter-banner strong { color: var(--amber); }
  .filter-banner-clear { background: none; border: 1px solid var(--border); color: var(--text-muted); font-family: 'Space Mono', monospace; font-size: 11px; padding: 3px 10px; cursor: pointer; margin-left: auto; transition: border-color 0.15s, color 0.15s; }
  .filter-banner-clear:hover { border-color: var(--amber); color: var(--amber); }

  @media (max-width: 700px) {
    .site-nav { padding: 0 16px; } .nav-link { padding: 8px 8px; font-size: 10px; }
    .header, .controls, .table-wrap, .pagination { padding-left: 16px; padding-right: 16px; }
    .td-album { display: none; }
  }
</style>
</head>
<body>

<nav class="site-nav">
  <a class="site-logo" href="index.html">Daily <span>Jam</span></a>
  <div class="nav-links">
    <a class="nav-link" href="index.html">Home</a>
    <a class="nav-link active" href="catalog.html">Catalog</a>
    <a class="nav-link" href="calendar.html">Calendar</a>
    <a class="nav-link" href="stats.html">Stats</a>
    <a class="nav-link" href="shuffle.html">Shuffle</a>
    <a class="nav-link" href="daily-jam-links.html">Links</a>
  </div>
</nav>

<div class="header">
  <div class="header-top">
    <div class="title-block">
      <h1>Daily <span>Jam</span></h1>
      <p>One song · Every day · No repeats · Sept 24, 2018</p>
    </div>
    <div class="stats-strip">
      <div class="stat">
        <div class="stat-num" id="total-songs">—</div>
        <div class="stat-label">Songs</div>
      </div>
      <div class="stat">
        <div class="stat-num" id="total-artists">—</div>
        <div class="stat-label">Artists</div>
      </div>
      <div class="stat">
        <div class="stat-num">8</div>
        <div class="stat-label">Years</div>
      </div>
    </div>
  </div>
  <div class="year-tabs">
    <button class="year-tab active" data-year="0">All Years</button>
    <button class="year-tab" data-year="1">Daily Jam 1</button>
    <button class="year-tab" data-year="2">Daily Jam 2</button>
    <button class="year-tab" data-year="3">Daily Jam 3</button>
    <button class="year-tab" data-year="4">Daily Jam 4</button>
    <button class="year-tab" data-year="5">Daily Jam 5</button>
    <button class="year-tab" data-year="6">Daily Jam 6</button>
    <button class="year-tab" data-year="7">Daily Jam 7</button>
    <button class="year-tab" data-year="8">Daily Jam 8</button>
  </div>
</div>

<div class="controls">
  <div class="search-wrap">
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
    <input type="text" id="search" placeholder="Search songs, artists, albums…">
  </div>
  <select id="sort-by">
    <option value="0-asc">Sort: Day # ↑</option>
    <option value="0-desc">Sort: Day # ↓</option>
    <option value="2-asc">Sort: Song A–Z</option>
    <option value="3-asc">Sort: Artist A–Z</option>
  </select>
  <div class="result-count"><span id="count-display">—</span> songs</div>
</div>

<div class="filter-banner" id="filter-banner">
  <span id="filter-banner-text"></span>
  <button class="filter-banner-clear" id="filter-banner-clear">✕ Clear filter</button>
</div>

<div class="table-header">
  <table>
    <colgroup>
      <col class="col-day"><col class="col-song"><col class="col-artist"><col class="col-album"><col class="col-date"><col class="col-year">
    </colgroup>
    <thead>
      <tr>
        <th class="sorted asc" data-col="0">Day</th>
        <th data-col="2">Song</th>
        <th data-col="3">Artist</th>
        <th data-col="4">Album</th>
        <th data-col="5">Date</th>
        <th>Year</th>
      </tr>
    </thead>
  </table>
</div>
<div class="table-wrap">
  <table>
    <colgroup>
      <col class="col-day"><col class="col-song"><col class="col-artist"><col class="col-album"><col class="col-date"><col class="col-year">
    </colgroup>
    <thead><tr><th></th><th></th><th></th><th></th><th></th><th></th></tr></thead>
    <tbody id="song-table"></tbody>
  </table>
</div>
<div class="pagination" id="pagination"></div>

<div class="modal-overlay" id="modal-overlay">
  <div class="modal">
    <button class="modal-close" id="modal-close">×</button>
    <div class="modal-header">
      <h2 id="m-name">—</h2>
      <div class="modal-artist" id="m-artist">—</div>
      <div class="modal-album" id="m-album">—</div>
    </div>
    <div class="modal-body">
      <div class="modal-meta">
        <div class="modal-meta-item"><label>Jam Date</label><span id="m-added">—</span></div>
        <div class="modal-meta-item"><label>Day Number</label><span id="m-daynum">—</span></div>
        <div class="modal-meta-item"><label>Playlist Year</label><span id="m-year">—</span></div>
        <div class="modal-meta-item"><label>Release Year</label><span id="m-release">—</span></div>
      </div>
      <div class="modal-actions">
        <a class="btn-spotify" id="m-spotify-link" href="#" target="_blank">▶ Open in Spotify</a>
      </div>
    </div>
  </div>
</div>

<script>
function getDailyJamYear(dayNum) {
  const daysInYears = [365, 366, 365, 365, 365, 366, 365, 365];
  let total = 0;
  for (let i = 0; i < daysInYears.length; i++) {
    total += daysInYears[i];
    if (dayNum <= total) return i + 1;
  }
  return 8;
}

const YEAR_LABELS = ['','2018–19','2019–20','2020–21','2021–22','2022–23','2023–24','2024–25','2025–26'];

let SONGS = [];
let filtered = [];
let currentYear = 0;
let currentSort = '0-asc';
let currentPage = 1;
const PAGE_SIZE = 50;
let songMap = {};
let activeDecade = null; // e.g. "2010s", set by URL param

const DECADE_RANGES = {
  'pre-60s': [0, 1959], '1960s': [1960, 1969], '1970s': [1970, 1979],
  '1980s': [1980, 1989], '1990s': [1990, 1999], '2000s': [2000, 2009],
  '2010s': [2010, 2019], '2020s': [2020, 2099]
};

function applyFilters() {
  const q = document.getElementById('search').value.toLowerCase().trim();
  const qNorm = q.replace(/\s+/g, '');
  filtered = SONGS.filter(s => {
    if (currentYear !== 0 && getDailyJamYear(s[0]) !== currentYear) return false;
    if (activeDecade !== null) {
      const range = DECADE_RANGES[activeDecade];
      const yr = parseInt(s[14], 10);
      if (!range || yr < range[0] || yr > range[1]) return false;
    }
    if (q) {
      const haystack = (s[2] + ' ' + s[3] + ' ' + s[4]).toLowerCase();
      const haystackNorm = haystack.replace(/\s+/g, '');
      if (!haystack.includes(q) && !haystackNorm.includes(qNorm)) return false;
    }
    return true;
  });
  applySort();
}

function applySort() {
  const parts = currentSort.split('-');
  const col = parseInt(parts[0]);
  const asc = parts[1] === 'asc';
  filtered.sort((a, b) => {
    let av = a[col], bv = b[col];
    if (typeof av === 'string') { av = av.toLowerCase(); bv = bv.toLowerCase(); }
    else { av = Number(av); bv = Number(bv); }
    if (av < bv) return asc ? -1 : 1;
    if (av > bv) return asc ? 1 : -1;
    return 0;
  });
  currentPage = 1;
  render();
}

function render() {
  const start = (currentPage - 1) * PAGE_SIZE;
  const page = filtered.slice(start, start + PAGE_SIZE);
  document.getElementById('count-display').textContent = filtered.length.toLocaleString();
  document.getElementById('song-table').innerHTML = page.map(s => `
    <tr onclick="openModal('${s[1]}')">
      <td class="td-num" style="text-align:right">${s[0].toLocaleString()}</td>
      <td class="td-name">${s[2]}${s[7] ? '<span class="explicit-tag">E</span>' : ''}</td>
      <td class="td-artist y${getDailyJamYear(s[0])}-text">${s[3]}</td>
      <td class="td-album y${getDailyJamYear(s[0])}-text">${s[4]}</td>
      <td class="td-date y${getDailyJamYear(s[0])}-text">${s[5]}</td>
      <td><span class="year-pill y${getDailyJamYear(s[0])}">DJ ${getDailyJamYear(s[0])}</span></td>
    </tr>`).join('');
  renderPagination();
}

function renderPagination() {
  const total = Math.ceil(filtered.length / PAGE_SIZE);
  const pag = document.getElementById('pagination');
  if (total <= 1) { pag.innerHTML = ''; return; }
  let html = `<button class="page-btn" onclick="goPage(${currentPage-1})" ${currentPage===1?'disabled':''}>← Prev</button>`;
  let pages = [...new Set([1,total,currentPage,currentPage-1,currentPage+1,currentPage-2,currentPage+2].filter(p=>p>=1&&p<=total))].sort((a,b)=>a-b);
  let prev = null;
  for (let p of pages) {
    if (prev !== null && p - prev > 1) html += `<span style="color:var(--text-muted);padding:0 4px">…</span>`;
    html += `<button class="page-btn ${p===currentPage?'active':''}" onclick="goPage(${p})">${p}</button>`;
    prev = p;
  }
  html += `<button class="page-btn" onclick="goPage(${currentPage+1})" ${currentPage===total?'disabled':''}>Next →</button>`;
  pag.innerHTML = html;
}

function goPage(p) {
  const total = Math.ceil(filtered.length / PAGE_SIZE);
  if (p < 1 || p > total) return;
  currentPage = p;
  render();
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

function openModal(id) {
  const s = songMap[id];
  if (!s) return;
  document.getElementById('m-name').textContent = s[2];
  document.getElementById('m-artist').textContent = s[3];
  document.getElementById('m-album').textContent = s[4];
  document.getElementById('m-added').textContent = s[5];
  document.getElementById('m-daynum').textContent = `Day ${s[0].toLocaleString()} of ${SONGS.length.toLocaleString()}`;
  document.getElementById('m-year').textContent = `Year ${getDailyJamYear(s[0])} (${YEAR_LABELS[getDailyJamYear(s[0])]})`;
  document.getElementById('m-release').textContent = s[14] || '—';
  document.getElementById('m-spotify-link').href = `https://open.spotify.com/track/${s[1]}`;
  document.getElementById('modal-overlay').classList.add('open');
}

document.getElementById('modal-close').onclick = () => document.getElementById('modal-overlay').classList.remove('open');
document.getElementById('modal-overlay').onclick = function(e) { if (e.target===this) this.classList.remove('open'); };
document.addEventListener('keydown', e => { if (e.key==='Escape') document.getElementById('modal-overlay').classList.remove('open'); });

function updateSortHeaders() {
  const parts = currentSort.split('-');
  const col = parts[0];
  const asc = parts[1] === 'asc';
  document.querySelectorAll('.table-header th[data-col]').forEach(th => {
    th.classList.remove('sorted', 'asc');
    if (th.dataset.col === col) {
      th.classList.add('sorted');
      if (asc) th.classList.add('asc');
    }
  });
}

document.querySelectorAll('.table-header th[data-col]').forEach(th => {
  th.addEventListener('click', function() {
    const col = this.dataset.col;
    const [curCol, curDir] = currentSort.split('-');
    currentSort = col + '-' + (col === curCol && curDir === 'asc' ? 'desc' : 'asc');
    document.getElementById('sort-by').value = currentSort in {'0-asc':1,'0-desc':1,'2-asc':1,'3-asc':1} ? currentSort : '0-asc';
    updateSortHeaders();
    applyFilters();
  });
});

document.getElementById('search').addEventListener('input', applyFilters);
document.getElementById('sort-by').addEventListener('change', function() { currentSort = this.value; updateSortHeaders(); applyFilters(); });
document.querySelectorAll('.year-tab').forEach(btn => {
  btn.addEventListener('click', function() {
    document.querySelectorAll('.year-tab').forEach(b => b.classList.remove('active'));
    this.classList.add('active');
    currentYear = parseInt(this.dataset.year);
    applyFilters();
  });
});

function updateFilterBanner() {
  const banner = document.getElementById('filter-banner');
  const text = document.getElementById('filter-banner-text');
  if (activeDecade !== null) {
    text.innerHTML = `Filtered by release decade: <strong>${activeDecade}</strong>`;
    banner.classList.add('visible');
  } else {
    banner.classList.remove('visible');
  }
}

document.getElementById('filter-banner-clear').addEventListener('click', () => {
  activeDecade = null;
  updateFilterBanner();
  applyFilters();
});

Promise.all([1,2,3,4,5,6,7,8].map(y =>
  fetch(`songs-dj${y}.json`)
    .then(r => r.text())
    .then(txt => {
      // Strip UTF-8 BOM if present
      if (txt.charCodeAt(0) === 0xFEFF) txt = txt.slice(1);
      return JSON.parse(txt);
    })
))
  .then(arrays => {
    SONGS = arrays.flat();
    // Ensure day numbers are proper integers
    SONGS.forEach(s => { s[0] = parseInt(s[0], 10); });
    SONGS.forEach(s => songMap[s[1]] = s);
    document.getElementById('total-songs').textContent = SONGS.length.toLocaleString();
    document.getElementById('total-artists').textContent = new Set(SONGS.map(s => s[3])).size.toLocaleString();

    // Read URL params for pre-filtering from stats page
    const params = new URLSearchParams(window.location.search);
    if (params.has('search')) {
      document.getElementById('search').value = params.get('search');
    }
    if (params.has('decade')) {
      activeDecade = params.get('decade');
      updateFilterBanner();
    }

    applyFilters();
  });
</script>
</body>
</html>
