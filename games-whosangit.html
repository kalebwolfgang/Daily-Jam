<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Daily Jam — Who Sang It?</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,700;0,900;1,700&family=Space+Mono:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0e0c0f; --surface: #161418; --surface2: #1e1b21; --border: #272330;
    --amber: #9b6dff; --amber-glow: rgba(155,109,255,0.12);
    --text: #e8e0d0; --text-dim: #9e9080; --text-muted: #6a6460;
    --green: #5dba7f; --red: #e85d4a;
    --y1:#5d8fe8; --y2:#5dba7f; --y3:#e85d8f; --y4:#e8a45d;
    --y5:#a45de8; --y6:#5de8e8; --y7:#e8e85d; --y8:#FF6B6B;
    --cc: #a45de8;
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body { background: #0a0810; color: var(--text); font-family: 'Space Mono', monospace; min-height: 100vh; overflow-x: hidden; }
  body::before { content: ''; position: fixed; inset: 0; pointer-events: none; z-index: 0;
    background:
      radial-gradient(ellipse 90% 70% at 5%  0%,   rgba(155,109,255,0.38) 0%, transparent 65%),
      radial-gradient(ellipse 70% 60% at 95% 100%,  rgba(93,143,232,0.28)  0%, transparent 60%),
      radial-gradient(ellipse 55% 45% at 88% 5%,    rgba(232,93,143,0.18)  0%, transparent 55%),
      radial-gradient(ellipse 50% 40% at 3%  95%,   rgba(93,186,127,0.18)  0%, transparent 55%); }
  body::after { content: ''; position: fixed; inset: 0; background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.04'/%3E%3C/svg%3E"); pointer-events: none; z-index: 9999; opacity: 0.4; }

  /* ── NAV ─────────────────────────────────────────────────── */
  .site-nav { position: sticky; top: 0; z-index: 100; display: flex; align-items: center; justify-content: space-between; padding: 0 40px; height: 56px; background: rgba(14,12,15,0.95); border-bottom: 1px solid var(--border); backdrop-filter: blur(8px); }
  .site-logo { font-family: 'Space Mono', monospace; font-size: 16px; font-weight: 700; color: var(--text); text-decoration: none; letter-spacing: 1px; }
  .site-logo span { color: var(--amber); font-style: italic; }
  .nav-links { display: flex; gap: 4px; align-items: center; }
  .nav-link { font-size: 11px; letter-spacing: 2px; text-transform: uppercase; color: var(--text-dim); text-decoration: none; padding: 8px 14px; transition: color 0.15s; }
  .nav-link:hover { color: var(--text); }
  .nav-link.active { color: var(--amber); }

  /* ── GAME HEADER ─────────────────────────────────────────── */
  .game-header { position: relative; z-index: 1; padding: 16px 48px; border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; gap: 16px; }
  .game-title-row { display: flex; flex-direction: column; gap: 4px; }
  .game-eyebrow { font-size: 10px; letter-spacing: 3px; text-transform: uppercase; color: var(--cc); }
  .game-title-text { font-family: 'Playfair Display', serif; font-size: 24px; font-weight: 700; }
  .header-stats { display: flex; align-items: center; gap: 36px; }
  .stat-block { display: flex; flex-direction: column; align-items: center; gap: 3px; }
  .stat-label { font-size: 10px; letter-spacing: 2px; text-transform: uppercase; color: var(--text-muted); }
  .stat-val { font-family: 'Playfair Display', serif; font-size: 32px; font-weight: 900; line-height: 1; }
  .stat-val.streak { color: var(--cc); }
  .stat-val.best   { color: var(--amber); }
  .stat-val.score  { color: var(--green); }

  /* ── MAIN LAYOUT ─────────────────────────────────────────── */
  .game-body { position: relative; z-index: 1; max-width: 1200px; margin: 0 auto; padding: 48px 48px 80px; display: flex; flex-direction: column; gap: 32px; }

  /* Song title — full width, big */
  .song-card { background: var(--surface); border: 1px solid var(--border); padding: 36px 48px; display: flex; flex-direction: column; gap: 8px; }
  .song-card-eyebrow { font-size: 10px; letter-spacing: 4px; text-transform: uppercase; color: var(--text-muted); }
  .song-title { font-family: 'Playfair Display', serif; font-size: clamp(32px, 4.5vw, 64px); font-weight: 900; line-height: 1.05; color: var(--text); }

  /* 2-col row: embed left, choices right */
  .main-row { display: grid; grid-template-columns: 1fr 1.4fr; gap: 24px; align-items: start; }

  /* ── SPOTIFY EMBED ───────────────────────────────────────── */
  .embed-col { display: flex; flex-direction: column; gap: 14px; }
  .embed-label { font-size: 10px; letter-spacing: 3px; text-transform: uppercase; color: var(--text-muted); }
  .embed-frame-wrap { position: relative; border: 1px solid var(--border); overflow: hidden; background: var(--surface); height: 200px; }
  .embed-frame-wrap iframe { display: block; border: none; }

  /* Text blocker — covers song title / artist text but not album art or controls */
  .text-blocker {
    position: absolute; top: 0; bottom: 0;
    left: 104px; right: 120px;
    background: var(--surface);
    pointer-events: none;
    z-index: 3;
  }
  .text-blocker.hidden { display: none; }

  /* Full-cover play button shown before first click */
  .play-btn-wrap {
    position: absolute; inset: 0; z-index: 10;
    display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 16px;
    background: var(--surface);
    cursor: pointer;
    transition: background 0.15s;
  }
  .play-btn-wrap:hover { background: var(--surface2); }
  .play-btn-wrap.hidden { display: none; }
  .play-circle {
    width: 72px; height: 72px; border-radius: 50%;
    background: var(--cc); display: flex; align-items: center; justify-content: center;
    transition: opacity 0.15s;
  }
  .play-btn-wrap:hover .play-circle { opacity: 0.85; }
  .play-triangle {
    width: 0; height: 0;
    border-top: 13px solid transparent;
    border-bottom: 13px solid transparent;
    border-left: 22px solid #0a0810;
    margin-left: 5px;
  }
  .play-btn-label { font-size: 10px; letter-spacing: 3px; text-transform: uppercase; color: var(--text-muted); }
  .embed-hint { font-size: 10px; color: var(--text-muted); letter-spacing: 1px; line-height: 1.7; }

  /* ── CHOICES COLUMN ──────────────────────────────────────── */
  .choices-col { display: flex; flex-direction: column; gap: 14px; }
  .choices-label { font-size: 10px; letter-spacing: 3px; text-transform: uppercase; color: var(--text-muted); }
  .choices-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
  .choice-btn {
    background: var(--surface); border: 2px solid var(--border); color: var(--text);
    font-family: 'Space Mono', monospace; font-size: 13px; font-weight: 700; letter-spacing: 0.5px;
    padding: 24px 22px; text-align: left; cursor: pointer;
    transition: border-color 0.15s, background 0.15s, color 0.15s;
    display: flex; align-items: center; gap: 14px; position: relative; overflow: hidden;
    min-height: 88px; line-height: 1.4;
  }
  .choice-btn::after { content: ''; position: absolute; bottom: 0; left: 0; right: 0; height: 3px; background: var(--cc); transform: scaleX(0); transform-origin: left; transition: transform 0.2s; }
  .choice-btn:hover:not(:disabled) { border-color: var(--cc); background: var(--surface2); }
  .choice-btn:hover:not(:disabled)::after { transform: scaleX(1); }
  .choice-btn:disabled { cursor: default; }
  .choice-btn.correct  { border-color: var(--green); background: rgba(93,186,127,0.08); color: var(--green); }
  .choice-btn.correct::after { background: var(--green); transform: scaleX(1); }
  .choice-btn.wrong    { border-color: var(--red); background: rgba(232,93,74,0.08); color: var(--red); opacity: 0.7; }
  .choice-btn.wrong::after { display: none; }
  .choice-btn.reveal   { border-color: var(--green); background: rgba(93,186,127,0.08); color: var(--green); }
  .choice-btn.reveal::after { background: var(--green); transform: scaleX(1); }
  .choice-letter { font-size: 11px; letter-spacing: 2px; color: var(--text-muted); flex-shrink: 0; min-width: 18px; }
  .choice-btn.correct .choice-letter,
  .choice-btn.wrong   .choice-letter,
  .choice-btn.reveal  .choice-letter { color: inherit; opacity: 0.7; }

  /* ── RESULT BANNER ───────────────────────────────────────── */
  .result-banner { display: none; flex-direction: row; align-items: center; gap: 24px; padding: 24px 32px; border: 1px solid var(--border); }
  .result-banner.correct { border-color: var(--green); background: rgba(93,186,127,0.05); }
  .result-banner.wrong   { border-color: var(--red);   background: rgba(232,93,74,0.05); }
  .result-left { display: flex; flex-direction: column; gap: 5px; flex: 1; }
  .result-verdict { font-size: 11px; font-weight: 700; letter-spacing: 3px; text-transform: uppercase; }
  .result-banner.correct .result-verdict { color: var(--green); }
  .result-banner.wrong   .result-verdict { color: var(--red); }
  .result-detail { font-size: 13px; color: var(--text-dim); line-height: 1.7; }
  .result-pts { font-family: 'Playfair Display', serif; font-size: 48px; font-weight: 900; flex-shrink: 0; line-height: 1; }
  .result-banner.correct .result-pts { color: var(--green); }
  .result-banner.wrong   .result-pts  { color: var(--red); }

  /* ── NEXT / GAME OVER BUTTON ─────────────────────────────── */
  .next-row { display: flex; justify-content: center; }
  .next-btn { display: none; background: var(--cc); color: #0a0810; font-family: 'Space Mono', monospace; font-size: 12px; font-weight: 700; letter-spacing: 3px; text-transform: uppercase; padding: 16px 56px; border: none; cursor: pointer; transition: opacity 0.15s; }
  .next-btn:hover { opacity: 0.85; }
  .next-btn.game-over { background: var(--red); }

  /* ── SUMMARY SCREEN ──────────────────────────────────────── */
  .summary-screen { display: none; position: relative; z-index: 1; max-width: 760px; margin: 0 auto; padding: 60px 48px 80px; flex-direction: column; gap: 32px; align-items: center; text-align: center; }
  .sum-eye    { font-size: 10px; letter-spacing: 4px; text-transform: uppercase; color: var(--text-muted); }
  .sum-head   { font-family: 'Playfair Display', serif; font-size: clamp(40px, 7vw, 84px); font-weight: 900; color: var(--red); line-height: 0.92; }
  .sum-streak { font-family: 'Playfair Display', serif; font-size: clamp(72px, 12vw, 140px); font-weight: 900; color: var(--cc); line-height: 1; }
  .sum-streak-label { font-size: 11px; letter-spacing: 4px; text-transform: uppercase; color: var(--text-muted); margin-top: -8px; }
  .sum-sub    { font-size: 13px; color: var(--text-dim); line-height: 1.9; max-width: 480px; }
  .sum-rows   { width: 100%; display: flex; flex-direction: column; gap: 1px; background: var(--border); border: 1px solid var(--border); text-align: left; }
  .sum-row    { background: var(--surface); display: grid; grid-template-columns: auto 1fr auto auto; align-items: center; gap: 16px; padding: 16px 20px; }
  .sum-num    { font-size: 11px; color: var(--text-muted); min-width: 20px; }
  .sum-song   { overflow: hidden; }
  .sum-title  { font-size: 12px; color: var(--text); overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
  .sum-artist-ans { font-size: 10px; color: var(--text-muted); margin-top: 2px; }
  .sum-verdict { font-size: 18px; }
  .sum-pts    { font-family: 'Playfair Display', serif; font-size: 20px; font-weight: 700; }
  .sum-pts.p1000 { color: var(--green); }
  .sum-pts.p0    { color: var(--red); }
  .sum-actions { display: flex; gap: 12px; flex-wrap: wrap; justify-content: center; }
  .sum-btn { font-family: 'Space Mono', monospace; font-size: 11px; font-weight: 700; letter-spacing: 3px; text-transform: uppercase; padding: 14px 32px; border: none; cursor: pointer; transition: opacity 0.15s; }
  .sum-btn.primary   { background: var(--cc); color: #0a0810; }
  .sum-btn.secondary { background: transparent; border: 1px solid var(--border); color: var(--text-dim); }
  .sum-btn:hover { opacity: 0.8; }

  @media (max-width: 960px) {
    .main-row { grid-template-columns: 1fr; }
  }
  @media (max-width: 700px) {
    .site-nav { padding: 0 16px; }
    .game-header { padding: 12px 16px; }
    .header-stats { gap: 20px; }
    .stat-val { font-size: 24px; }
    .game-body { padding: 24px 16px 60px; gap: 24px; }
    .song-card { padding: 24px 20px; }
    .choices-grid { grid-template-columns: 1fr; }
    .result-banner { flex-direction: column; gap: 12px; }
    .result-pts { font-size: 36px; }
    .summary-screen { padding: 40px 16px 60px; }
  }
</style>
</head>
<body>

<nav class="site-nav">
  <a class="site-logo" href="index.html">Daily <span>Jam</span></a>
  <div class="nav-links">
    <a class="nav-link" href="index.html">Home</a>
    <a class="nav-link" href="catalog.html">Catalog</a>
    <a class="nav-link" href="calendar.html">Calendar</a>
    <a class="nav-link" href="stats.html">Stats</a>
    <a class="nav-link" href="shuffle.html">Shuffle</a>
    <a class="nav-link active" href="games.html">Games</a>
    <a class="nav-link" href="daily-jam-links.html">Links</a>
  </div>
</nav>

<!-- GAME HEADER -->
<div class="game-header">
  <div class="game-title-row">
    <span class="game-eyebrow">Game 06</span>
    <span class="game-title-text">Who Sang It?</span>
  </div>
  <div class="header-stats">
    <div class="stat-block">
      <span class="stat-label">Streak</span>
      <span class="stat-val streak" id="streak-val">0</span>
    </div>
    <div class="stat-block">
      <span class="stat-label">Best</span>
      <span class="stat-val best" id="best-val">0</span>
    </div>
    <div class="stat-block">
      <span class="stat-label">Score</span>
      <span class="stat-val score" id="score-val">0</span>
    </div>
  </div>
</div>

<!-- GAME BODY -->
<div class="game-body" id="game-body">

  <!-- Song title — full width -->
  <div class="song-card">
    <span class="song-card-eyebrow">Song Title</span>
    <span class="song-title" id="song-title">Loading…</span>
  </div>

  <!-- 2-col: embed left, choices right -->
  <div class="main-row">

    <!-- LEFT: Spotify embed -->
    <div class="embed-col">
      <span class="embed-label">Listen for a clue</span>
      <div class="embed-frame-wrap" id="embed-frame-wrap">
        <!-- iframe injected by JS -->
        <div class="text-blocker" id="text-blocker"></div>
        <div class="play-btn-wrap" id="play-btn-wrap" onclick="revealEmbed()">
          <div class="play-circle"><div class="play-triangle"></div></div>
          <span class="play-btn-label">Play Preview</span>
        </div>
      </div>
      <span class="embed-hint">30-second preview — artist name hidden until you answer.</span>
    </div>

    <!-- RIGHT: answer choices -->
    <div class="choices-col">
      <span class="choices-label">Who sang this song?</span>
      <div class="choices-grid" id="choices-grid"></div>
    </div>

  </div>

  <!-- Result banner -->
  <div class="result-banner" id="result-banner">
    <div class="result-left">
      <span class="result-verdict" id="result-verdict"></span>
      <span class="result-detail"  id="result-detail"></span>
    </div>
    <span class="result-pts" id="result-pts"></span>
  </div>

  <!-- Next / Game Over button -->
  <div class="next-row">
    <button class="next-btn" id="next-btn" onclick="nextRound()"></button>
  </div>

</div>

<!-- SUMMARY SCREEN -->
<div class="summary-screen" id="summary-screen">
  <p class="sum-eye">Game Over — Wrong Answer</p>
  <h2 class="sum-head">Streak<br>Broken</h2>
  <div class="sum-streak" id="sum-streak"></div>
  <p class="sum-streak-label">in a row</p>
  <p class="sum-sub" id="sum-sub"></p>
  <div class="sum-rows" id="sum-rows"></div>
  <div class="sum-actions">
    <button class="sum-btn primary" onclick="restartGame()">Play Again →</button>
    <a class="sum-btn secondary" href="games.html">All Games</a>
  </div>
</div>

<script>
// ── CONFIG ───────────────────────────────────────────────────────────────────
const DJ_YEARS = [
  { num:1, label:'DJ1', color:'#5d8fe8', start:'2018-09-24', end:'2019-09-23' },
  { num:2, label:'DJ2', color:'#5dba7f', start:'2019-09-24', end:'2020-09-23' },
  { num:3, label:'DJ3', color:'#e85d8f', start:'2020-09-24', end:'2021-09-23' },
  { num:4, label:'DJ4', color:'#e8a45d', start:'2021-09-24', end:'2022-09-23' },
  { num:5, label:'DJ5', color:'#a45de8', start:'2022-09-24', end:'2023-09-23' },
  { num:6, label:'DJ6', color:'#5de8e8', start:'2023-09-24', end:'2024-09-23' },
  { num:7, label:'DJ7', color:'#e8e85d', start:'2024-09-24', end:'2025-09-23' },
  { num:8, label:'DJ8', color:'#FF6B6B', start:'2025-09-24', end:'2026-09-23' },
];
const CHOICES = 4;

// ── STATE ────────────────────────────────────────────────────────────────────
let allSongs   = [];
let usedSongs  = new Set(); // avoid repeating songs in a session
let history    = [];        // all rounds played this run
let streak     = 0;
let bestStreak = 0;
let totalScore = 0;
let answered   = false;
let currentRound = null;

// ── INIT ─────────────────────────────────────────────────────────────────────
(async function init() {
  const arrays = await Promise.all([1,2,3,4,5,6,7,8].map(y =>
    fetch(`songs-dj${y}.json`)
      .then(r => r.text())
      .then(txt => { if (txt.charCodeAt(0) === 0xFEFF) txt = txt.slice(1); return JSON.parse(txt); })
  ));
  allSongs = arrays.flat();
  buildRound();
  renderRound();
})();

// ── HELPERS ──────────────────────────────────────────────────────────────────
function shuffle(arr) {
  const a = [...arr];
  for (let i = a.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}
function getDJYear(dateStr) {
  return DJ_YEARS.find(y => dateStr >= y.start && dateStr <= y.end) || DJ_YEARS[0];
}

// ── BUILD ONE ROUND ───────────────────────────────────────────────────────────
function buildRound() {
  // Pick a song not yet used this session
  const pool = allSongs.filter(s => !usedSongs.has(s[1]));
  const song = shuffle(pool.length ? pool : allSongs)[0]; // if all used, allow repeats
  usedSongs.add(song[1]);

  const allArtists = [...new Set(allSongs.map(s => s[3]))];
  const wrongs     = shuffle(allArtists.filter(a => a !== song[3])).slice(0, CHOICES - 1);
  const choices    = shuffle([song[3], ...wrongs]);

  currentRound = { song, choices, correctIndex: choices.indexOf(song[3]), result: null };
}

// ── RENDER ROUND ──────────────────────────────────────────────────────────────
function renderRound() {
  answered = false;
  const r  = currentRound;

  // Song title
  document.getElementById('song-title').textContent = r.song[2];

  // Spotify embed — load silently, play button covers it
  const wrap = document.getElementById('embed-frame-wrap');
  const old  = wrap.querySelector('iframe');
  if (old) old.remove();
  const iframe = document.createElement('iframe');
  iframe.src    = `https://open.spotify.com/embed/track/${r.song[1]}?utm_source=generator&theme=0`;
  iframe.width  = '100%';
  iframe.height = '200';
  iframe.setAttribute('frameborder', '0');
  iframe.setAttribute('allow', 'autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture');
  iframe.setAttribute('loading', 'lazy');
  wrap.insertBefore(iframe, document.getElementById('text-blocker'));
  document.getElementById('text-blocker').classList.remove('hidden');
  document.getElementById('play-btn-wrap').classList.remove('hidden');

  // Choices
  const grid    = document.getElementById('choices-grid');
  grid.innerHTML = '';
  const letters  = ['A', 'B', 'C', 'D'];
  r.choices.forEach((artist, i) => {
    const btn = document.createElement('button');
    btn.className = 'choice-btn';
    btn.innerHTML = `<span class="choice-letter">${letters[i]}</span>${escHtml(artist)}`;
    btn.onclick   = () => selectAnswer(i);
    grid.appendChild(btn);
  });

  // Reset result + next btn
  const rb = document.getElementById('result-banner');
  rb.style.display = 'none';
  rb.className     = 'result-banner';
  document.getElementById('next-btn').style.display = 'none';
}

// ── REVEAL EMBED (play button click) ─────────────────────────────────────────
function revealEmbed() {
  const r    = currentRound;
  const wrap = document.getElementById('embed-frame-wrap');
  const old  = wrap.querySelector('iframe');
  if (old) old.remove();
  const iframe = document.createElement('iframe');
  iframe.src    = `https://open.spotify.com/embed/track/${r.song[1]}?utm_source=generator&theme=0&autoplay=1`;
  iframe.width  = '100%';
  iframe.height = '200';
  iframe.setAttribute('frameborder', '0');
  iframe.setAttribute('allow', 'autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture');
  wrap.insertBefore(iframe, document.getElementById('text-blocker'));
  document.getElementById('play-btn-wrap').classList.add('hidden');
}

// ── ANSWER ────────────────────────────────────────────────────────────────────
function selectAnswer(choiceIdx) {
  if (answered) return;
  answered = true;

  const r       = currentRound;
  const correct = choiceIdx === r.correctIndex;
  const pts     = correct ? 1000 : 0;
  r.result      = { choiceIdx, correct, pts };

  if (correct) {
    streak++;
    if (streak > bestStreak) bestStreak = streak;
    totalScore += pts;
  } else {
    // Wrong — streak ends, record this round then show summary
  }

  // Update header stats
  document.getElementById('streak-val').textContent = streak;
  document.getElementById('best-val').textContent   = bestStreak;
  document.getElementById('score-val').textContent  = totalScore;

  // Style buttons
  const btns = document.querySelectorAll('.choice-btn');
  btns.forEach((btn, i) => {
    btn.disabled = true;
    if (i === r.correctIndex)    btn.classList.add(correct && i === choiceIdx ? 'correct' : 'reveal');
    else if (i === choiceIdx)    btn.classList.add('wrong');
  });

  // Reveal artist in embed
  document.getElementById('play-btn-wrap').classList.add('hidden');
  document.getElementById('text-blocker').classList.add('hidden');

  // Result banner
  const yr = getDJYear(r.song[5]);
  const rb = document.getElementById('result-banner');
  rb.className     = `result-banner ${correct ? 'correct' : 'wrong'}`;
  rb.style.display = 'flex';
  document.getElementById('result-verdict').textContent = correct ? `✓ Correct! Streak: ${streak}` : '✗ Wrong — streak over!';
  document.getElementById('result-pts').textContent     = correct ? `+${pts}` : '✗';
  document.getElementById('result-detail').innerHTML    =
    `<strong>${escHtml(r.song[2])}</strong> is by <strong>${escHtml(r.song[3])}</strong>`
    + ` &mdash; <span style="color:${yr.color}">${yr.label}</span> (${r.song[5]})`;

  // Save to history
  history.push({ ...r });

  // Next button
  const nextBtn = document.getElementById('next-btn');
  nextBtn.style.display = 'block';
  if (correct) {
    nextBtn.textContent = 'Next Song →';
    nextBtn.className   = 'next-btn';
  } else {
    nextBtn.textContent = 'See Results →';
    nextBtn.className   = 'next-btn game-over';
  }
}

// ── NEXT ROUND ────────────────────────────────────────────────────────────────
function nextRound() {
  const lastResult = history[history.length - 1];
  if (lastResult && !lastResult.result.correct) {
    showSummary();
    return;
  }
  buildRound();
  renderRound();
}

// ── SUMMARY ───────────────────────────────────────────────────────────────────
function showSummary() {
  document.getElementById('game-body').style.display     = 'none';
  document.getElementById('summary-screen').style.display = 'flex';

  const finalStreak = history.filter(r => r.result.correct).length;
  document.getElementById('sum-streak').textContent = finalStreak;
  document.getElementById('sum-sub').textContent    =
    `${finalStreak} correct in a row — ${totalScore.toLocaleString()} pts total`;

  const rows = document.getElementById('sum-rows');
  rows.innerHTML = '';
  history.forEach((r, i) => {
    const yr   = getDJYear(r.song[5]);
    const isOk = r.result.correct;
    const row  = document.createElement('div');
    row.className = 'sum-row';
    row.innerHTML = `
      <div class="sum-num">${i + 1}</div>
      <div class="sum-song">
        <div class="sum-title">${escHtml(r.song[2])}</div>
        <div class="sum-artist-ans" style="color:${yr.color}">${escHtml(r.song[3])} · ${yr.label}</div>
      </div>
      <div class="sum-verdict">${isOk ? '✓' : '✗'}</div>
      <div class="sum-pts ${isOk ? 'p1000' : 'p0'}">${isOk ? '+1000' : '0'}</div>
    `;
    rows.appendChild(row);
  });
}

// ── RESTART ───────────────────────────────────────────────────────────────────
function restartGame() {
  streak     = 0;
  totalScore = 0;
  answered   = false;
  history    = [];
  usedSongs  = new Set();
  document.getElementById('streak-val').textContent         = '0';
  document.getElementById('score-val').textContent          = '0';
  // best persists across restarts this session
  document.getElementById('summary-screen').style.display   = 'none';
  document.getElementById('game-body').style.display        = 'flex';
  buildRound();
  renderRound();
}

// ── UTIL ──────────────────────────────────────────────────────────────────────
function escHtml(s) {
  return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}
</script>
</body>
</html>
