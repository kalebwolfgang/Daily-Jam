<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Daily Jam â€” Day Guesser</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,700;0,900;1,700&family=Space+Mono:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0e0c0f; --surface: #161418; --surface2: #1e1b21; --border: #272330;
    --amber: #9b6dff; --amber-glow: rgba(155,109,255,0.12);
    --text: #e8e0d0; --text-dim: #9e9080; --text-muted: #6a6460;
    --green: #5dba7f; --red: #e85d4a;
    --y1:#5d8fe8; --y2:#5dba7f; --y3:#e85d8f; --y4:#e8a45d;
    --y5:#a45de8; --y6:#5de8e8; --y7:#e8e85d; --y8:#FF6B6B;
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body { background: #0a0810; color: var(--text); font-family: 'Space Mono', monospace; min-height: 100vh; overflow-x: hidden; }
  body::before { content: ''; position: fixed; inset: 0; pointer-events: none; z-index: 0;
    background:
      radial-gradient(ellipse 90% 70% at 5%  0%,   rgba(155,109,255,0.38) 0%, transparent 65%),
      radial-gradient(ellipse 70% 60% at 95% 100%,  rgba(93,143,232,0.28)  0%, transparent 60%),
      radial-gradient(ellipse 55% 45% at 88% 5%,    rgba(232,93,143,0.18)  0%, transparent 55%),
      radial-gradient(ellipse 50% 40% at 3%  95%,   rgba(93,186,127,0.18)  0%, transparent 55%); }
  body::after { content: ''; position: fixed; inset: 0; background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.04'/%3E%3C/svg%3E"); pointer-events: none; z-index: 9999; opacity: 0.4; }

  /* NAV */
  .site-nav { position: sticky; top: 0; z-index: 100; display: flex; align-items: center; justify-content: space-between; padding: 0 40px; height: 56px; background: rgba(14,12,15,0.95); border-bottom: 1px solid var(--border); backdrop-filter: blur(8px); }
  .site-logo { font-family: 'Space Mono', monospace; font-size: 16px; font-weight: 700; color: var(--text); text-decoration: none; letter-spacing: 1px; }
  .site-logo span { color: var(--amber); font-style: italic; }
  .nav-links { display: flex; gap: 4px; align-items: center; }
  .nav-link { font-size: 11px; letter-spacing: 2px; text-transform: uppercase; color: var(--text-dim); text-decoration: none; padding: 8px 14px; transition: color 0.15s; }
  .nav-link:hover { color: var(--text); }
  .nav-link.active { color: var(--amber); }

  /* GAME LAYOUT */
  .game-wrap { position: relative; z-index: 1; min-height: calc(100vh - 56px); display: flex; flex-direction: column; }

  /* HEADER BAR */
  .game-header { padding: 20px 40px; border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; gap: 24px; }
  .game-title-row { display: flex; flex-direction: column; gap: 4px; flex-shrink: 0; }
  .game-eyebrow { font-size: 10px; letter-spacing: 3px; text-transform: uppercase; color: var(--y4); }
  .game-title { font-family: 'Playfair Display', serif; font-size: 28px; font-weight: 700; }

  /* PROGRESS PIPS */
  .progress-row { display: flex; align-items: center; gap: 16px; flex: 1; justify-content: center; }
  .round-pips { display: flex; gap: 6px; }
  .pip { width: 10px; height: 10px; border: 1px solid var(--border); background: var(--surface2); transition: background 0.2s, border-color 0.2s; }
  .pip.bullseye { background: var(--green);  border-color: var(--green); }
  .pip.close    { background: var(--y4);     border-color: var(--y4); }
  .pip.off      { background: var(--red);    border-color: var(--red); }
  .pip.current  { border-color: var(--text-dim); }

  /* SCORE */
  .score-display { display: flex; flex-direction: column; align-items: flex-end; gap: 2px; flex-shrink: 0; }
  .score-label { font-size: 10px; letter-spacing: 2px; text-transform: uppercase; color: var(--text-muted); }
  .score-num { font-family: 'Playfair Display', serif; font-size: 36px; font-weight: 900; color: var(--amber); line-height: 1; }

  /* LOADING */
  .loading { display: flex; align-items: center; justify-content: center; flex: 1; font-size: 11px; color: var(--text-muted); letter-spacing: 3px; text-transform: uppercase; }

  /* MAIN GAME BODY */
  .game-body { flex: 1; display: flex; flex-direction: column; padding: 36px 40px; gap: 28px; max-width: 820px; margin: 0 auto; width: 100%; }

  /* SONG CARD */
  .song-card { background: var(--surface); border: 1px solid var(--border); padding: 32px 40px; text-align: center; }
  .song-label { font-size: 10px; letter-spacing: 3px; text-transform: uppercase; color: var(--text-muted); margin-bottom: 14px; }
  .song-title { font-family: 'Playfair Display', serif; font-size: clamp(20px, 3.5vw, 38px); font-weight: 900; line-height: 1.15; color: var(--text); }
  .song-artist { margin-top: 10px; font-size: 15px; color: var(--text-dim); }

  /* DJ YEAR SELECTOR */
  .year-select-section { display: flex; flex-direction: column; gap: 12px; }
  .year-select-label { font-size: 10px; letter-spacing: 3px; text-transform: uppercase; color: var(--text-muted); }
  .year-btn-row { display: grid; grid-template-columns: repeat(8, 1fr); gap: 6px; }
  .yr-btn {
    font-family: 'Space Mono', monospace; font-size: 11px; font-weight: 700; letter-spacing: 1px;
    padding: 10px 4px; border: 2px solid var(--btn-color); color: var(--btn-color);
    background: transparent; cursor: pointer;
    transition: background 0.15s, color 0.15s;
    display: flex; flex-direction: column; align-items: center; gap: 2px;
  }
  .yr-btn:hover { background: var(--btn-color); color: #0a0810; }
  .yr-btn.selected { background: var(--btn-color); color: #0a0810; }
  .yr-btn-sub { font-size: 8px; letter-spacing: 1px; font-weight: 400; opacity: 0.8; }

  /* SLIDER SECTION */
  .slider-section { display: flex; flex-direction: column; gap: 14px; }
  .slider-header { display: flex; align-items: center; justify-content: space-between; }
  .slider-label { font-size: 10px; letter-spacing: 3px; text-transform: uppercase; color: var(--text-muted); }
  .slider-hint { font-size: 10px; color: var(--text-muted); letter-spacing: 1px; }

  /* Slider track + thumb */
  .slider-wrap { position: relative; padding: 12px 0; }
  .slider-track-bg { position: absolute; top: 50%; left: 0; right: 0; height: 4px; background: var(--border); transform: translateY(-50%); pointer-events: none; }
  .slider-track-fill { position: absolute; top: 50%; left: 0; height: 4px; background: var(--active-color, var(--amber)); transform: translateY(-50%); pointer-events: none; transition: width 0.05s; }
  input[type="range"] {
    -webkit-appearance: none; appearance: none;
    width: 100%; height: 4px; background: transparent;
    outline: none; cursor: pointer; position: relative; z-index: 1;
  }
  input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none; appearance: none;
    width: 22px; height: 22px;
    background: var(--active-color, var(--amber));
    border: 2px solid #0a0810;
    cursor: pointer;
    transition: transform 0.1s;
  }
  input[type="range"]::-webkit-slider-thumb:hover { transform: scale(1.15); }
  input[type="range"]::-moz-range-thumb {
    width: 22px; height: 22px;
    background: var(--active-color, var(--amber));
    border: 2px solid #0a0810;
    cursor: pointer; border-radius: 0;
  }

  /* Date display below slider */
  .slider-date-row { display: flex; align-items: center; justify-content: space-between; }
  .slider-date-start { font-size: 10px; color: var(--text-muted); letter-spacing: 1px; }
  .slider-date-end   { font-size: 10px; color: var(--text-muted); letter-spacing: 1px; }
  .slider-date-current {
    font-family: 'Playfair Display', serif; font-size: 22px; font-weight: 700;
    color: var(--active-color, var(--amber)); text-align: center; flex: 1;
    transition: color 0.2s;
  }

  /* SUBMIT */
  .submit-row { display: flex; justify-content: center; }
  .submit-btn { font-family: 'Space Mono', monospace; font-size: 11px; font-weight: 700; letter-spacing: 2px; text-transform: uppercase; padding: 14px 48px; background: var(--amber); color: #0a0810; border: none; cursor: pointer; transition: opacity 0.15s, transform 0.1s; }
  .submit-btn:hover { opacity: 0.88; }
  .submit-btn:active { transform: scale(0.97); }
  .submit-btn:disabled { opacity: 0.3; cursor: default; }

  /* RESULT AREA */
  .result-area { display: none; background: var(--surface); border: 1px solid var(--border); padding: 28px 36px; text-align: center; }
  .result-area.visible { display: block; }
  .result-area.bullseye { border-color: var(--green); background: rgba(93,186,127,0.07); }
  .result-area.close    { border-color: var(--y4);    background: rgba(232,164,93,0.07); }
  .result-area.off      { border-color: var(--red);   background: rgba(232,93,74,0.07); }

  .result-headline { font-family: 'Playfair Display', serif; font-size: 24px; font-weight: 700; margin-bottom: 8px; }
  .result-area.bullseye .result-headline { color: var(--green); }
  .result-area.close    .result-headline { color: var(--y4); }
  .result-area.off      .result-headline { color: var(--red); }

  .result-dates { display: flex; align-items: center; justify-content: center; gap: 20px; flex-wrap: wrap; margin-bottom: 16px; }
  .result-date-item { display: flex; flex-direction: column; align-items: center; gap: 4px; }
  .result-date-lbl { font-size: 9px; letter-spacing: 2px; text-transform: uppercase; color: var(--text-muted); }
  .result-date-val { font-size: 14px; font-weight: 700; }
  .result-date-divider { font-size: 20px; color: var(--text-muted); }
  .result-distance { font-size: 11px; color: var(--text-dim); letter-spacing: 1px; margin-bottom: 20px; }

  .result-points { font-family: 'Playfair Display', serif; font-size: 40px; font-weight: 900; color: var(--amber); margin-bottom: 4px; }
  .result-points-label { font-size: 10px; letter-spacing: 2px; text-transform: uppercase; color: var(--text-muted); margin-bottom: 20px; }

  .next-btn { font-family: 'Space Mono', monospace; font-size: 10px; letter-spacing: 2px; text-transform: uppercase; padding: 12px 28px; border: 1px solid var(--border); color: var(--text); background: transparent; cursor: pointer; transition: background 0.15s; }
  .next-btn:hover { background: var(--surface2); }

  /* NO YEAR SELECTED nudge */
  .year-nudge { font-size: 10px; color: var(--red); letter-spacing: 1px; text-align: center; display: none; }
  .year-nudge.visible { display: block; }

  /* SUMMARY */
  .summary { display: none; flex-direction: column; flex: 1; }
  .summary-header { padding: 40px 40px 24px; border-bottom: 1px solid var(--border); text-align: center; }
  .summary-title { font-family: 'Playfair Display', serif; font-size: 48px; font-weight: 900; }
  .summary-total { font-family: 'Playfair Display', serif; font-size: 80px; font-weight: 900; color: var(--amber); line-height: 1; }
  .summary-total-label { font-size: 11px; letter-spacing: 3px; text-transform: uppercase; color: var(--text-muted); margin-top: 4px; }
  .summary-rows { flex: 1; }
  .summary-row { display: grid; grid-template-columns: 32px 1fr 120px auto; align-items: center; gap: 16px; padding: 14px 40px; border-bottom: 1px solid var(--border); }
  .summary-row:hover { background: var(--surface); }
  .summary-rnum { font-size: 10px; color: var(--text-muted); }
  .summary-song { font-size: 12px; }
  .summary-song-title  { color: var(--text); font-size: 13px; font-weight: 700; }
  .summary-song-artist { font-size: 10px; color: var(--text-dim); margin-top: 2px; }
  .summary-dates { font-size: 10px; color: var(--text-muted); line-height: 1.7; }
  .summary-dates strong { display: block; color: var(--text-dim); font-size: 11px; }
  .summary-pts { font-family: 'Playfair Display', serif; font-size: 20px; font-weight: 700; color: var(--amber); text-align: right; }
  .summary-pts.zero  { color: var(--red); }
  .summary-pts.low   { color: var(--text-dim); }
  .summary-pts.mid   { color: var(--y4); }
  .summary-pts.close { color: var(--y2); }
  .summary-footer { padding: 32px 40px; border-top: 1px solid var(--border); display: flex; justify-content: center; gap: 16px; }
  .restart-btn { font-family: 'Space Mono', monospace; font-size: 11px; letter-spacing: 2px; text-transform: uppercase; padding: 14px 32px; border: 1px solid var(--amber); color: var(--amber); background: transparent; cursor: pointer; transition: background 0.15s, color 0.15s; }
  .restart-btn:hover { background: var(--amber); color: #0a0810; }
  .hub-btn { font-family: 'Space Mono', monospace; font-size: 11px; letter-spacing: 2px; text-transform: uppercase; padding: 14px 32px; border: 1px solid var(--border); color: var(--text-dim); background: transparent; cursor: pointer; text-decoration: none; display: inline-block; transition: background 0.15s; }
  .hub-btn:hover { background: var(--surface2); color: var(--text); }

  @media (max-width: 900px) {
    .site-nav { padding: 0 16px; }
    .game-header { padding: 16px; flex-wrap: wrap; }
    .game-body { padding: 20px 16px; gap: 20px; }
    .year-btn-row { grid-template-columns: repeat(4, 1fr); }
    .summary-row { padding: 12px 16px; grid-template-columns: 24px 1fr auto; gap: 10px; }
    .summary-dates { display: none; }
    .summary-header { padding: 28px 16px 20px; }
    .summary-footer { padding: 24px 16px; }
    .song-card { padding: 24px 20px; }
  }
  @media (max-width: 500px) {
    .nav-links .nav-link { padding: 8px 8px; font-size: 10px; }
    .year-btn-row { grid-template-columns: repeat(4, 1fr); }
    .round-pips { gap: 4px; }
    .pip { width: 8px; height: 8px; }
  }
</style>
</head>
<body>

<nav class="site-nav">
  <a class="site-logo" href="index.html">Daily <span>Jam</span></a>
  <div class="nav-links">
    <a class="nav-link" href="index.html">Home</a>
    <a class="nav-link" href="catalog.html">Catalog</a>
    <a class="nav-link" href="calendar.html">Calendar</a>
    <a class="nav-link" href="stats.html">Stats</a>
    <a class="nav-link" href="shuffle.html">Shuffle</a>
    <a class="nav-link active" href="games.html">Games</a>
    <a class="nav-link" href="daily-jam-links.html">Links</a>
  </div>
</nav>

<div class="game-wrap">

  <div class="game-header">
    <div class="game-title-row">
      <div class="game-eyebrow">Game 04</div>
      <div class="game-title">Day Guesser</div>
    </div>
    <div class="progress-row">
      <div class="round-pips" id="pips"></div>
    </div>
    <div class="score-display">
      <div class="score-label">Score</div>
      <div class="score-num" id="score-display">0</div>
    </div>
  </div>

  <div id="loading-state" class="loading">Loading catalog...</div>

  <!-- GAME STATE -->
  <div id="game-state" style="display:none; flex-direction:column; flex:1;">
    <div class="game-body">

      <!-- Song card -->
      <div class="song-card">
        <div class="song-label">When was this song added?</div>
        <div class="song-title" id="song-title">â€”</div>
        <div class="song-artist" id="song-artist">â€”</div>
      </div>

      <!-- Step 1: Pick a DJ Year -->
      <div class="year-select-section">
        <div class="year-select-label">Step 1 â€” Pick a DJ Year</div>
        <div class="year-btn-row" id="year-btn-row"></div>
      </div>

      <!-- Step 2: Drag the slider -->
      <div class="slider-section" id="slider-section" style="opacity:0.3; pointer-events:none;">
        <div class="slider-header">
          <div class="slider-label">Step 2 â€” Pick the exact date</div>
          <div class="slider-hint" id="slider-hint">Select a year first</div>
        </div>
        <div class="slider-wrap">
          <div class="slider-track-bg"></div>
          <div class="slider-track-fill" id="slider-fill"></div>
          <input type="range" id="date-slider" min="0" max="100" value="50">
        </div>
        <div class="slider-date-row">
          <div class="slider-date-start" id="date-start">â€”</div>
          <div class="slider-date-current" id="date-current">â€”</div>
          <div class="slider-date-end" id="date-end">â€”</div>
        </div>
      </div>

      <!-- Year nudge -->
      <div class="year-nudge" id="year-nudge">â† Pick a DJ year first</div>

      <!-- Submit -->
      <div class="submit-row">
        <button class="submit-btn" id="submit-btn" onclick="submitGuess()">Lock In Date â†’</button>
      </div>

      <!-- Result -->
      <div class="result-area" id="result-area">
        <div class="result-headline" id="result-headline"></div>
        <div class="result-dates">
          <div class="result-date-item">
            <div class="result-date-lbl">Your Guess</div>
            <div class="result-date-val" id="result-guess-date" style="color: var(--text-dim)"></div>
          </div>
          <div class="result-date-divider">â†’</div>
          <div class="result-date-item">
            <div class="result-date-lbl">Actual Date</div>
            <div class="result-date-val" id="result-actual-date" style="color: var(--green)"></div>
          </div>
        </div>
        <div class="result-distance" id="result-distance"></div>
        <div class="result-points" id="result-points"></div>
        <div class="result-points-label">points</div>
        <button class="next-btn" id="next-btn" onclick="nextRound()">Next Round â†’</button>
      </div>

    </div>
  </div>

  <!-- SUMMARY STATE -->
  <div class="summary" id="summary-state">
    <div class="summary-header">
      <div class="summary-title">Final Score</div>
      <div class="summary-total" id="summary-total">0</div>
      <div class="summary-total-label">out of 10,000 points</div>
    </div>
    <div class="summary-rows" id="summary-rows"></div>
    <div class="summary-footer">
      <a class="hub-btn" href="games.html">â† Back to Games</a>
      <button class="restart-btn" onclick="restartGame()">Play Again</button>
    </div>
  </div>

</div>

<script>
// â”€â”€ DJ Year config â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const DJ_YEARS = [
  { num:1, label:'DJ1', color:'#5d8fe8', start:'2018-09-24', end:'2019-09-23' },
  { num:2, label:'DJ2', color:'#5dba7f', start:'2019-09-24', end:'2020-09-23' },
  { num:3, label:'DJ3', color:'#e85d8f', start:'2020-09-24', end:'2021-09-23' },
  { num:4, label:'DJ4', color:'#e8a45d', start:'2021-09-24', end:'2022-09-23' },
  { num:5, label:'DJ5', color:'#a45de8', start:'2022-09-24', end:'2023-09-23' },
  { num:6, label:'DJ6', color:'#5de8e8', start:'2023-09-24', end:'2024-09-23' },
  { num:7, label:'DJ7', color:'#e8e85d', start:'2024-09-24', end:'2025-09-23' },
  { num:8, label:'DJ8', color:'#FF6B6B', start:'2025-09-24', end:'2026-09-23' },
];

// Precomputed: days in each year (for slider range)
function daysBetween(d1, d2) {
  return Math.round((new Date(d2) - new Date(d1)) / 86400000);
}

// â”€â”€ Scoring â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Scoring tiers (days off from actual date):
//   0 days        = 1000 pts  (Bullseye)
//   1â€“30 days     = 750 pts   (Within a month)
//   31â€“182 days   = 500 pts   (Within 6 months)
//   183â€“365 days  = 250 pts   (Within a year)
//   366+ days     = 0 pts     (Wrong year / too far off)
//
// Picking the wrong DJ year is an automatic 0 ONLY if the guessed date is
// more than 365 days from the actual date. Fringe dates near year boundaries
// (e.g. Sep 25 guessed in the year before) can still score if within 365 days.
function calcPoints(daysOff) {
  if (daysOff === 0)         return 1000;
  if (daysOff <= 30)         return 750;
  if (daysOff <= 182)        return 500;
  if (daysOff <= 365)        return 250;
  return 0;
}

function tierFromDaysOff(daysOff) {
  if (daysOff === 0)    return 'bullseye';
  if (daysOff <= 182)   return 'close';
  return 'off';
}

function headlineFromDaysOff(daysOff) {
  if (daysOff === 0)    return 'Bullseye! ğŸ¯';
  if (daysOff <= 30)    return 'Within a Month!';
  if (daysOff <= 182)   return 'Within 6 Months';
  if (daysOff <= 365)   return 'Within a Year';
  return 'Wrong Year';
}

// â”€â”€ Constants â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const TOTAL_ROUNDS = 10;

// â”€â”€ Game state â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let allSongsByYear = [];
let rounds = [];
let roundIdx = 0;
let totalScore = 0;
let history = [];
let submitted = false;

let selectedYearNum = null;  // which DJ year button is selected
let sliderDates = [];        // array of "YYYY-MM-DD" strings for the selected year
let currentSliderIdx = 0;

// â”€â”€ LOAD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadData() {
  try {
    const arrays = await Promise.all([1,2,3,4,5,6,7,8].map(y =>
      fetch(`songs-dj${y}.json`)
        .then(r => r.text())
        .then(txt => { if (txt.charCodeAt(0) === 0xFEFF) txt = txt.slice(1); return JSON.parse(txt); })
    ));
    allSongsByYear = arrays;
    document.getElementById('loading-state').style.display = 'none';
    startGame();
  } catch(e) {
    document.getElementById('loading-state').textContent = 'Failed to load catalog.';
  }
}

// â”€â”€ START / RESTART â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function startGame() {
  rounds = pickRounds();
  roundIdx = 0;
  totalScore = 0;
  history = [];
  submitted = false;

  document.getElementById('score-display').textContent = '0';
  document.getElementById('summary-state').style.display = 'none';
  document.getElementById('game-state').style.display = 'flex';
  buildPips();
  buildYearButtons();
  loadRound();
}

function restartGame() { startGame(); }

// Pick 10 rounds: 1 guaranteed from each of the 8 years + 2 random extras
function pickRounds() {
  const selected = [];
  const used = Array(8).fill(null).map(() => new Set());
  for (let y = 0; y < 8; y++) {
    const pool = allSongsByYear[y];
    const idx = Math.floor(Math.random() * pool.length);
    used[y].add(idx);
    selected.push({ song: pool[idx], yearNum: y + 1 });
  }
  for (let i = 0; i < 2; i++) {
    let y, idx;
    do {
      y = Math.floor(Math.random() * 8);
      idx = Math.floor(Math.random() * allSongsByYear[y].length);
    } while (used[y].has(idx));
    used[y].add(idx);
    selected.push({ song: allSongsByYear[y][idx], yearNum: y + 1 });
  }
  return selected.sort(() => Math.random() - 0.5);
}

// â”€â”€ PIPS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildPips() {
  const c = document.getElementById('pips');
  c.innerHTML = '';
  for (let i = 0; i < TOTAL_ROUNDS; i++) {
    const p = document.createElement('div');
    p.className = 'pip' + (i === 0 ? ' current' : '');
    p.id = `pip-${i}`;
    c.appendChild(p);
  }
}

function updatePip(idx, cls) {
  const p = document.getElementById(`pip-${idx}`);
  if (p) p.className = 'pip ' + cls;
  const n = document.getElementById(`pip-${idx + 1}`);
  if (n) n.classList.add('current');
}

// â”€â”€ YEAR BUTTONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildYearButtons() {
  const row = document.getElementById('year-btn-row');
  row.innerHTML = '';
  DJ_YEARS.forEach(yr => {
    const btn = document.createElement('button');
    btn.className = 'yr-btn';
    btn.id = `yr-btn-${yr.num}`;
    btn.style.setProperty('--btn-color', yr.color);
    btn.innerHTML = `<span>${yr.label}</span><span class="yr-btn-sub">Year ${yr.num}</span>`;
    btn.onclick = () => selectYear(yr.num);
    row.appendChild(btn);
  });
}

function selectYear(num) {
  if (submitted) return;
  selectedYearNum = num;

  // Update button styles
  DJ_YEARS.forEach(yr => {
    const btn = document.getElementById(`yr-btn-${yr.num}`);
    if (btn) btn.classList.toggle('selected', yr.num === num);
  });

  // Enable & configure the slider for this year
  const yr = DJ_YEARS[num - 1];
  const activeColor = yr.color;

  // Build date array for the selected DJ year only â€” one entry per day from start to end.
  // This keeps the slider manageable (365â€“366 positions).
  // Scoring is based purely on days off from the actual date regardless of year chosen,
  // so picking the wrong year naturally results in 0 pts (>365 days off).
  const start = new Date(yr.start);
  const end   = new Date(yr.end);
  sliderDates = [];
  const cur = new Date(start);
  while (cur <= end) {
    sliderDates.push(cur.toISOString().slice(0, 10));
    cur.setDate(cur.getDate() + 1);
  }

  const slider = document.getElementById('date-slider');
  slider.min = 0;
  slider.max = sliderDates.length - 1;
  slider.value = Math.floor(sliderDates.length / 2); // default to middle of year
  currentSliderIdx = parseInt(slider.value);

  // Update colors
  const sliderSection = document.getElementById('slider-section');
  sliderSection.style.setProperty('--active-color', activeColor);
  sliderSection.style.opacity = '1';
  sliderSection.style.pointerEvents = 'auto';

  document.getElementById('slider-hint').textContent = `${yr.start} â†’ ${yr.end}`;
  document.getElementById('date-start').textContent = formatDateShort(yr.start);
  document.getElementById('date-end').textContent   = formatDateShort(yr.end);

  updateSliderDisplay();
  document.getElementById('year-nudge').classList.remove('visible');
}

// â”€â”€ SLIDER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.getElementById('date-slider').addEventListener('input', function() {
  if (submitted) return;
  currentSliderIdx = parseInt(this.value);
  updateSliderDisplay();
});

function updateSliderDisplay() {
  const slider = document.getElementById('date-slider');
  const pct = (parseInt(slider.value) / (sliderDates.length - 1)) * 100;

  document.getElementById('slider-fill').style.width = pct + '%';
  document.getElementById('date-current').textContent = formatDateFull(sliderDates[currentSliderIdx]);
}

// â”€â”€ ROUND â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function loadRound() {
  submitted = false;
  selectedYearNum = null;

  const { song } = rounds[roundIdx];
  document.getElementById('song-title').textContent  = song[2];
  document.getElementById('song-artist').textContent = song[3];

  // Reset year buttons
  DJ_YEARS.forEach(yr => {
    const btn = document.getElementById(`yr-btn-${yr.num}`);
    if (btn) { btn.classList.remove('selected'); btn.disabled = false; }
  });

  // Reset slider section â€” sliderDates will be rebuilt when a year is selected
  sliderDates = [];
  const sliderSection = document.getElementById('slider-section');
  sliderSection.style.opacity = '0.3';
  sliderSection.style.pointerEvents = 'none';
  sliderSection.style.removeProperty('--active-color');
  document.getElementById('slider-hint').textContent = 'Select a year first';
  document.getElementById('date-start').textContent  = 'â€”';
  document.getElementById('date-end').textContent    = 'â€”';
  document.getElementById('date-current').textContent = 'â€”';
  document.getElementById('slider-fill').style.width = '0%';
  document.getElementById('date-slider').value = 50;

  // Reset result
  const ra = document.getElementById('result-area');
  ra.className = 'result-area';
  ra.style.display = 'none';

  // Reset submit
  const btn = document.getElementById('submit-btn');
  btn.disabled = false;
  btn.textContent = 'Lock In Date â†’';
  document.getElementById('year-nudge').classList.remove('visible');

  // Last round label on next button
  if (roundIdx >= TOTAL_ROUNDS - 1) {
    document.getElementById('next-btn').textContent = 'See Results â†’';
  } else {
    document.getElementById('next-btn').textContent = 'Next Round â†’';
  }
}

// â”€â”€ SUBMIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function submitGuess() {
  if (submitted) return;

  if (!selectedYearNum) {
    document.getElementById('year-nudge').classList.add('visible');
    return;
  }

  submitted = true;

  const { song } = rounds[roundIdx];
  const actualDate  = song[5];                           // "YYYY-MM-DD"
  const guessedDate = sliderDates[currentSliderIdx];

  const daysOff = Math.abs(daysBetween(actualDate, guessedDate));
  const pts     = calcPoints(daysOff);
  const tier    = tierFromDaysOff(daysOff);
  totalScore   += pts;

  history.push({ song, actualDate, guessedDate, daysOff, pts, tier });

  // Update score display
  document.getElementById('score-display').textContent = totalScore.toLocaleString();

  // Update pip
  updatePip(roundIdx, tier);

  // Show result
  const ra = document.getElementById('result-area');
  ra.className = `result-area visible ${tier}`;
  ra.style.display = 'block';

  document.getElementById('result-headline').textContent    = headlineFromDaysOff(daysOff);
  document.getElementById('result-guess-date').textContent  = formatDateFull(guessedDate);
  document.getElementById('result-actual-date').textContent = formatDateFull(actualDate);
  const distMsg = daysOff === 0
    ? 'Exact match!'
    : `${daysOff} day${daysOff !== 1 ? 's' : ''} off`;
  document.getElementById('result-distance').textContent = distMsg;
  document.getElementById('result-points').textContent      = `+${pts.toLocaleString()}`;

  // Disable inputs
  document.getElementById('submit-btn').disabled = true;
  document.getElementById('submit-btn').textContent = 'Submitted';
  document.getElementById('date-slider').disabled = true;
  DJ_YEARS.forEach(yr => {
    const btn = document.getElementById(`yr-btn-${yr.num}`);
    if (btn) btn.disabled = true;
  });

  ra.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
}

// â”€â”€ NEXT ROUND â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function nextRound() {
  roundIdx++;
  if (roundIdx >= TOTAL_ROUNDS) {
    showSummary();
    return;
  }
  // Re-enable slider
  document.getElementById('date-slider').disabled = false;
  loadRound();
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

// â”€â”€ SUMMARY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showSummary() {
  document.getElementById('game-state').style.display = 'none';
  const sumEl = document.getElementById('summary-state');
  sumEl.style.display = 'flex';
  sumEl.style.flexDirection = 'column';

  document.getElementById('summary-total').textContent = totalScore.toLocaleString();

  const rowsEl = document.getElementById('summary-rows');
  rowsEl.innerHTML = '';

  history.forEach((h, i) => {
    const row = document.createElement('div');
    row.className = 'summary-row';

    const ptsClass = h.pts === 0 ? 'zero' : h.pts === 250 ? 'low' : h.pts === 500 ? 'mid' : h.pts === 750 ? 'close' : '';
    const djYr = getDJYearNum(h.actualDate);
    const yrColor = DJ_YEARS[djYr - 1] ? DJ_YEARS[djYr - 1].color : 'var(--text)';

    row.innerHTML = `
      <div class="summary-rnum">${i + 1}</div>
      <div class="summary-song">
        <div class="summary-song-title">${escHtml(h.song[2])}</div>
        <div class="summary-song-artist">${escHtml(h.song[3])}</div>
      </div>
      <div class="summary-dates">
        <strong style="color:${yrColor}">Actual: ${formatDateFull(h.actualDate)}</strong>
        Guess: ${formatDateFull(h.guessedDate)}<br>
        ${h.daysOff === 0 ? 'Exact!' : h.daysOff + ' day' + (h.daysOff !== 1 ? 's' : '') + ' off'}
      </div>
      <div class="summary-pts ${ptsClass}">+${h.pts.toLocaleString()}</div>
    `;
    rowsEl.appendChild(row);
  });

  window.scrollTo({ top: 0, behavior: 'smooth' });
}

// â”€â”€ HELPERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function getDJYearNum(dateStr) {
  for (const yr of DJ_YEARS) {
    if (dateStr >= yr.start && dateStr <= yr.end) return yr.num;
  }
  return 1;
}

function formatDateFull(dateStr) {
  // "YYYY-MM-DD" â†’ "Sep 24, 2018"
  const [y, m, d] = dateStr.split('-').map(Number);
  const months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
  return `${months[m - 1]} ${d}, ${y}`;
}

function formatDateShort(dateStr) {
  const [y, m, d] = dateStr.split('-').map(Number);
  const months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
  return `${months[m - 1]} ${y}`;
}

function escHtml(str) {
  return str.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}

// â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
loadData();
</script>
</body>
</html>
